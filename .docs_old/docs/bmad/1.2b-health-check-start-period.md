# BMAD: Health Check Start Period Configuration

**Story:** 1.2 - Docker Compose Setup
**Date:** 2025-10-28
**Severity:** Low (Best practice improvement)
**Status:** ✅ Implemented

---

## Behavior

### Enhancement Added

All services in docker-compose.yml include `start_period` parameter in health checks:

```yaml
postgres:
  healthcheck:
    test: ["CMD-SHELL", "pg_isready"]
    interval: 10s
    timeout: 5s
    retries: 5
    start_period: 10s  # ✅ Added

api:
  healthcheck:
    test: ["CMD-SHELL", "curl -f http://localhost:8000/health"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s  # ✅ Added (longer for Python startup)

agent:
  healthcheck:
    start_period: 40s  # ✅ Added
```

---

## Measure

### Without start_period (Default Behavior)

```bash
$ docker compose up -d
# PostgreSQL starting...
# Health check runs immediately: FAIL (postgres still initializing)
# Health check runs again: FAIL
# Health check runs again: FAIL
# After 5 failures: Container marked unhealthy
# But postgres actually healthy now!
```

### With start_period

```bash
$ docker compose up -d
# PostgreSQL starting...
# start_period: 10s - health checks don't count as failures yet
# After 10s, health checks start counting
# First check: PASS (postgres ready)
# Container marked healthy immediately
```

---

## Act

### Benefits

1. **Prevents False Failures**: Services have grace period to initialize
2. **Faster Startup**: Dependent services wait for actual health, not retry exhaustion
3. **Better Logging**: No misleading "unhealthy" logs during normal startup

### Recommended Values

- **PostgreSQL**: `start_period: 10s` (database initialization)
- **Redis**: `start_period: 10s` (module loading)
- **API**: `start_period: 40s` (Python imports + FastAPI startup)
- **Agent**: `start_period: 40s` (LangGraph + AsyncRedisSaver initialization)

---

## Document

### Lessons Learned

Always use `start_period` for services with non-trivial startup time.

**References**:
- Docker Compose healthcheck: https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck
- Best practice: start_period should cover 95th percentile startup time

---

**Impact**: Positive - Reliable container orchestration
**Epic 2+ Readiness**: ✅ Ready
