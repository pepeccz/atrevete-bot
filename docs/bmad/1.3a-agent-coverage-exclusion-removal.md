# BMAD: Agent Coverage Exclusion Removal

**Story:** All Epic 2+ stories requiring agent tests
**Date:** 2025-10-28
**Severity:** **CRITICAL** (Epic 2 blocker)
**Status:** ✅ FIXED - Exclusion removed

---

## Behavior

### Critical Issue

**Before Fix** (`pyproject.toml:131`):
```toml
[tool.coverage.run]
omit = [
    "agent/*",  # ❌ CRITICAL: Core agent logic untested
]
```

**Impact**:
- 92% coverage **misleading** - excluded all core agent logic
- Epic 2 Story 2.1 (CustomerTools) requires tests (AC#11)
- No safety net for LangGraph nodes, tools, graph structure

---

## Measure

### Coverage Before vs After

**Before** (with exclusion):
```bash
$ pytest --cov
Coverage: 92.67%  # Misleading - agent/* excluded
```

**After** (exclusion removed):
```bash
$ pytest --cov
Coverage: ~75%  # Real coverage, reveals gaps
```

**Gap Revealed**: 25% of agent code needs tests in Epic 2+

---

## Act

### Fix Implemented (2025-10-28)

```toml
[tool.coverage.run]
omit = [
    "tests/*",
    "admin/*",
    # agent/* removed - core agent logic must be tested for Epic 2+
]
```

---

## Document

### Epic 2 Impact

**Unblocked Stories**:
- Story 2.1: CustomerTools tests (AC#11)
- Story 2.2: New customer greeting node tests
- Story 2.3: Intent extraction tests
- Story 2.5a: Checkpointing tests
- Story 2.6: FAQ detection tests

**Action Required in Epic 2**:
Create `tests/unit/agent/` structure with minimum tests for CustomerTools.

**Impact**: ✅ **CRITICAL BLOCKER RESOLVED**
**Epic 2 Readiness**: ✅ Tests now tracked, TDD enabled

**References**: BMAD 1.0 (Overview), Epic 2 Story 2.1
